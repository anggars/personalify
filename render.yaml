# render.yaml

databases:
  # Ini adalah pengganti servis 'postgresfy' Anda.
  # Nama database dan user disamakan dengan .env Anda.
  - name: postgresfy
    plan: free
    databaseName: streamdb
    user: admin

services:
  # Ini adalah pengganti servis 'redisfy' Anda.
  - type: redis
    name: redisfy
    plan: free

  # Ini adalah servis backend FastAPI Anda.
  - type: web
    name: personalify-backend
    plan: free
    env: docker
    dockerfilePath: ./Dockerfile
    # Perintah untuk menjalankan aplikasi di produksi (tanpa --reload dan sleep)
    dockerCommand: "uvicorn app.main:app --host 0.0.0.0 --port 8000"
    envVars:
      # --- Variabel PostgreSQL (diisi otomatis oleh Render) ---
      - key: POSTGRES_HOST
        fromDatabase:
          name: postgresfy
          property: host
      - key: POSTGRES_PORT
        fromDatabase:
          name: postgresfy
          property: port
      - key: POSTGRES_DB
        fromDatabase:
          name: postgresfy
          property: database
      - key: POSTGRES_USER
        fromDatabase:
          name: postgresfy
          property: user
      - key: POSTGRES_PASSWORD
        fromDatabase:
          name: postgresfy
          property: password

      # --- Variabel Redis (diisi otomatis oleh Render) ---
      - key: REDIS_HOST
        fromService:
          type: redis
          name: redisfy
          property: host
      - key: REDIS_PORT
        fromService:
          type: redis
          name: redisfy
          property: port
      
      # --- Variabel Spotify & MongoDB (WAJIB DIISI MANUAL) ---
      # sync: false berarti nilai ini tidak akan diubah oleh render.yaml di masa depan.
      # Anda harus mengisinya sekali di dashboard Render.
      - key: SPOTIFY_CLIENT_ID
        sync: false
      - key: SPOTIFY_CLIENT_SECRET
        sync: false
      - key: SPOTIFY_REDIRECT_URI
        sync: false
      - key: MONGO_HOST 
        sync: false
      - key: MONGO_PORT
        sync: false